<scroll-view
  scroll-y="true"
  class="page"
  refresher-enabled="true"
  refresher-triggered="{{refresherTriggered}}"
  bindrefresherrefresh="onRefresherRefresh"
>
<view class="page">
  <view wx:if="{{loading}}">加载中...</view>

  <view wx:elif="{{!ok}}">
    <text>无权限或加载失败：</text>
    <text>{{error}}</text>
  </view>

  <view wx:else>
    <view class="header">
      <text>管理员数据总数：{{total}}</text>

      <view class="header-actions">
        <button size="mini" bindtap="refresh">刷新</button>
        <button size="mini" bindtap="onExportExcel">导出Excel</button>

        <!-- ⚠️ 危险操作：所有管理员都可见 -->
        <button
          size="mini"
          class="danger"
          bindtap="onDeleteAll">
          全部删除
        </button>

        <!-- 管理管理员：仍然只给总管理员 -->
        <button wx:if="{{adminRole === 'super_admin'}}"
                size="mini"
                bindtap="goAdminManage">
          管理管理员
        </button>
      </view>
    </view>

    <scroll-view scroll-x="true" class="table-scroll">
      <view class="table">

        <view class="tr th">
          <view class="td w-id">记录ID</view>
          <view class="td w-time">创建时间</view>
          <view class="td w-openid">用户ID</view>
          <view class="td w-m">牙套品牌</view>
          <view class="td w-m">替牙期</view>
          <view class="td w-s">n</view>
          <view class="td w-s">x</view>
          <view class="td w-s">k</view>
          <view class="td w-s">总排放(kg)</view>
          <view class="td w-op">操作</view>
        </view>

        <view class="tr" wx:for="{{records}}" wx:key="_id">
          <view class="td w-id">{{item._id}}</view>
          <view class="td w-time">{{item.createdAtBJ}}</view>
          <view class="td w-openid">{{item.openid}}</view>
          <view class="td w-m">{{item.brandLabel}}</view>
          <view class="td w-m">{{item.ageLabel}}</view>
          <view class="td w-s">{{item.inputs.n}}</view>
          <view class="td w-s">{{item.inputs.x}}</view>
          <view class="td w-s">{{item.inputs.k}}</view>
          <view class="td w-s">{{item.result.total_kg}}</view>

          <view class="td w-op">
            <button size="mini"
                    data-id="{{item._id}}"
                    bindtap="onDelete">
              删除
            </button>
          </view>
        </view>

        <view wx:if="{{records.length===0}}" class="empty">
          <text style="color:#999;">暂无数据</text>
        </view>

      </view>
    </scroll-view>
  </view>
</view>
</scroll-view>